<h1 align="center">üíä Pyllren</h1>

<p align="center">
  <b>Sistema monol√≠tico moderno para la gesti√≥n inteligente de inventario y ventas farmac√©uticas</b><br/>
  Optimizando la trazabilidad de lotes, sincronizaci√≥n entre sucursales y control de stock en tiempo real.
</p>

<p align="center">
  <img src="https://img.shields.io/badge/Made%20with-FastAPI-109989?logo=fastapi&logoColor=white" alt="FastAPI"/>
  <img src="https://img.shields.io/badge/Frontend-React-61DAFB?logo=react&logoColor=white" alt="React"/>
  <img src="https://img.shields.io/badge/Database-PostgreSQL-336791?logo=postgresql&logoColor=white" alt="PostgreSQL"/>
  <img src="https://img.shields.io/badge/Cache-Redis-DC382D?logo=redis&logoColor=white" alt="Redis"/>
  <img src="https://img.shields.io/badge/Concurrency-Threading-FF6B6B?logo=python&logoColor=white" alt="Threading"/>
  <img src="https://img.shields.io/badge/License-MIT-blue.svg" alt="License: MIT"/>
</p>

---

## üìã Tabla de Contenidos

- [Descripci√≥n General](#-descripci√≥n-general)
- [Arquitectura del Sistema](#-arquitectura-del-sistema)
- [Concurrencia y Procesamiento](#-concurrencia-y-procesamiento)
- [Endpoints API Relevantes](#-endpoints-api-relevantes)
- [Gesti√≥n de Roles y Permisos](#-gesti√≥n-de-roles-y-permisos)
- [Tecnolog√≠as Principales](#-tecnolog√≠as-principales)
- [Instalaci√≥n y Ejecuci√≥n](#-instalaci√≥n-y-ejecuci√≥n)

---

## üß© Descripci√≥n General

**Pyllren** es una plataforma integral para la **gesti√≥n farmac√©utica**, construida con una arquitectura **monol√≠tica moderna** que unifica un backend √°gil con **FastAPI** y un frontend interactivo con **React + TypeScript**.

### Caracter√≠sticas Principales

- üì¶ **Gesti√≥n de inventario multi-sucursal** con trazabilidad completa de lotes
- üîê **Control de acceso basado en roles** (RBAC) con 4 niveles de permisos
- üè¢ **Bodegas inteligentes** con validaci√≥n de capacidad y sugerencias de distribuci√≥n
- ‚ö° **Cach√© Redis** para optimizaci√≥n de queries frecuentes
- üîÑ **Procesamiento concurrente** para tareas de background
- üìä **Dashboard en tiempo real** con estad√≠sticas por sucursal
- üîç **Auditor√≠a completa** de operaciones cr√≠ticas

---

## üèóÔ∏è Arquitectura del Sistema

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      FRONTEND (React)                        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
‚îÇ  ‚îÇ  Dashboard   ‚îÇ  ‚îÇ   Lotes      ‚îÇ  ‚îÇ  Bodegas     ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ  Productos   ‚îÇ  ‚îÇ   Usuarios   ‚îÇ  ‚îÇ  Reportes    ‚îÇ      ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ HTTP/REST
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    BACKEND (FastAPI)                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ              API Routes (REST)                       ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  /users  /lotes  /bodegas  /productos  /stats       ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                            ‚îÇ                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
‚îÇ  ‚îÇ    Auth      ‚îÇ  ‚îÇ    Cache     ‚îÇ  ‚îÇ  Background  ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ  JWT + RBAC  ‚îÇ  ‚îÇ    Redis     ‚îÇ  ‚îÇ   Threads    ‚îÇ      ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  CAPA DE DATOS                               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
‚îÇ  ‚îÇ  PostgreSQL  ‚îÇ  ‚îÇ    Redis     ‚îÇ  ‚îÇ   MongoDB    ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ  (Principal) ‚îÇ  ‚îÇ   (Cache)    ‚îÇ  ‚îÇ   (Logs)     ‚îÇ      ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## ‚ö° Concurrencia y Procesamiento

### üßµ Hilos y Procesamiento As√≠ncrono

El sistema utiliza **concurrencia basada en hilos** y **locks de PostgreSQL** para garantizar la integridad de datos en operaciones cr√≠ticas:

#### 1. **Validaci√≥n de Capacidad de Bodegas** (`backend/app/api/routes/lotes.py`)

```python
def calcular_ocupacion_bodega(session: Session, bodega_id: int) -> int:
    """
    ‚ö†Ô∏è CONCURRENCIA: SELECT FOR UPDATE
    - Usa lock pesimista en PostgreSQL
    - Bloquea fila de bodega para evitar race conditions
    - Previene sobreventa/sobrecarga concurrente
    """
    bodega_lock_stmt = select(Bodega).where(
        Bodega.id_bodega == bodega_id
    ).with_for_update()  # üîí LOCK de fila
    
    session.exec(bodega_lock_stmt).one()  # Bloquea hasta commit/rollback
    # ... c√°lculo de ocupaci√≥n
```

**Escenario protegido:**
- ‚úÖ Usuario A intenta recepcionar 500 productos
- ‚úÖ Usuario B intenta recepcionar 600 productos simult√°neamente
- üîí El lock garantiza que solo uno proceda a la vez
- ‚úÖ El segundo usuario recibe error 409 con sugerencias

#### 2. **Recepci√≥n Distribuida de Lotes** (`backend/app/api/routes/lotes.py`)

```python
@router.post("/lotes/recepcion-distribuida")
def recepcion_lote_distribuida(payload: RecepcionDistribuidaPayload):
    """
    üîÑ CONCURRENCIA: Transacci√≥n at√≥mica con locks m√∫ltiples
    - Valida capacidad de N bodegas simult√°neamente
    - Crea sub-lotes en m√∫ltiples bodegas
    - Rollback autom√°tico si falla cualquier operaci√≥n
    """
    # Para cada bodega en la distribuci√≥n:
    #   1. Lock de la bodega (SELECT FOR UPDATE)
    #   2. Validaci√≥n de capacidad
    #   3. Creaci√≥n de sub-lote
    #   4. Commit o rollback global
```

#### 3. **Cach√© con Invalidaci√≥n Inteligente** (`backend/app/core/cache.py`)

```python
def invalidate_entity_cache(entity: str):
    """
    ‚ö° CONCURRENCIA: Invalidaci√≥n at√≥mica en Redis
    - Usa SCAN para patrones en lugar de KEYS (no bloqueante)
    - Invalidaci√≥n por entidad: users, lotes, bodegas, productos
    - TTL autom√°tico para prevenir crecimiento infinito
    """
    pattern = f"{entity}:*"
    cursor = 0
    while True:
        cursor, keys = redis_client.scan(
            cursor, match=pattern, count=100
        )
        # Invalidaci√≥n en lotes de 100 keys
```

#### 4. **Procesamiento de Background** (Futuro - Dise√±ado)

```python
# üîÑ TAREAS RECURRENTES PLANIFICADAS:

# Vigilancia de lotes pr√≥ximos a vencer (cada 6 horas)
@background_task(interval=21600)  
def verificar_lotes_proximos_vencer():
    """
    üîç RECURRENCIA: Escaneo programado
    - Identifica lotes que vencen en <30 d√≠as
    - Genera alertas autom√°ticas
    - Notifica a farmac√©uticos por sucursal
    """

# Sincronizaci√≥n entre sucursales (cada 1 hora)
@background_task(interval=3600)
def sincronizar_inventario_sucursales():
    """
    üîÑ CONCURRENCIA: Sincronizaci√≥n paralela
    - Usa ThreadPoolExecutor para procesar N sucursales
    - Actualiza stock en paralelo
    - Manejo de conflictos con last-write-wins
    """

# Backup autom√°tico de auditor√≠a (cada 24 horas)
@background_task(interval=86400)
def backup_auditoria_mongodb():
    """
    üíæ PERSISTENCIA: Backup incremental
    - Exporta logs de auditor√≠a a MongoDB
    - Limpia registros antiguos de PostgreSQL
    - Compresi√≥n y archivado autom√°tico
    """

# Limpieza de cach√© obsoleto (cada 12 horas)
@background_task(interval=43200)
def limpiar_cache_obsoleto():
    """
    üßπ MANTENIMIENTO: Limpieza autom√°tica
    - Elimina keys expiradas de Redis
    - Libera memoria de consultas antiguas
    - Recalcula estad√≠sticas populares
    """

# Precarga de productos populares (cada 4 horas)
@background_task(interval=14400)
def precargar_productos_populares():
    """
    ‚ö° OPTIMIZACI√ìN: Warm-up de cach√©
    - Identifica productos m√°s consultados
    - Precarga en Redis antes de horas pico
    - Reduce latencia en consultas frecuentes
    """
```

### üîê Control de Concurrencia

| T√©cnica | Ubicaci√≥n | Prop√≥sito |
|---------|-----------|-----------|
| **SELECT FOR UPDATE** | `lotes.py`, `bodegas.py` | Lock pesimista en operaciones cr√≠ticas |
| **Transacciones ACID** | Todas las operaciones de escritura | Atomicidad y consistencia |
| **Redis Cache TTL** | `cache.py` | Prevenci√≥n de datos obsoletos |
| **Query Debouncing** | Frontend (TanStack Query) | Reducci√≥n de requests concurrentes |
| **Invalidaci√≥n por patr√≥n** | `cache.py` | Sincronizaci√≥n cache-DB |

---

## üåê Endpoints API Relevantes

### üîê Autenticaci√≥n y Usuarios

| M√©todo | Endpoint | Descripci√≥n | Permisos |
|--------|----------|-------------|----------|
| `POST` | `/api/v1/login/access-token` | Login con JWT | P√∫blico |
| `POST` | `/api/v1/login/test-token` | Verificar token | Autenticado |
| `POST` | `/api/v1/password-recovery/{email}` | Recuperar contrase√±a | P√∫blico |
| `POST` | `/api/v1/reset-password/` | Resetear contrase√±a | P√∫blico |
| `GET` | `/api/v1/users/me` | Usuario actual | Autenticado |
| `PATCH` | `/api/v1/users/me` | Actualizar perfil | Autenticado |
| `GET` | `/api/v1/users/` | Listar usuarios | Admin |
| `POST` | `/api/v1/users/` | Crear usuario | Admin |
| `PATCH` | `/api/v1/users/{id}` | Actualizar usuario | Admin |
| `DELETE` | `/api/v1/users/{id}` | Eliminar usuario | Admin |

### üì¶ Gesti√≥n de Lotes

| M√©todo | Endpoint | Descripci√≥n | Concurrencia |
|--------|----------|-------------|--------------|
| `GET` | `/api/v1/lotes/` | Listar lotes | Filtrado por sucursal |
| `GET` | `/api/v1/lotes/stats` | Estad√≠sticas de lotes | Cache Redis (TTL 60s) |
| `POST` | `/api/v1/lotes/recepcion` | ‚ö†Ô∏è Recepci√≥n con validaci√≥n | **SELECT FOR UPDATE** |
| `POST` | `/api/v1/lotes/recepcion-distribuida` | ‚ö†Ô∏è Recepci√≥n multi-bodega | **Locks m√∫ltiples** |
| `GET` | `/api/v1/lotes/{id}` | Detalle de lote | - |
| `PUT` | `/api/v1/lotes/{id}` | Actualizar lote | Validaci√≥n de scope |
| `DELETE` | `/api/v1/lotes/{id}` | Eliminar lote | Soft delete |

**Algoritmos Especiales:**
- **Validaci√≥n de capacidad:** Lock de bodega + c√°lculo de ocupaci√≥n
- **Sugerencias autom√°ticas:** Algoritmo greedy para distribuir productos
- **Manejo de conflictos:** Error 409 con alternativas viables

### üè¢ Gesti√≥n de Bodegas

| M√©todo | Endpoint | Descripci√≥n | Filtrado |
|--------|----------|-------------|----------|
| `GET` | `/api/v1/bodegas/` | Listar bodegas | Por sucursal (scope) |
| `GET` | `/api/v1/bodegas/stats` | ‚ö° Estad√≠sticas globales | Cache + filtro sucursal |
| `GET` | `/api/v1/bodegas/{id}` | Detalle extendido | Incluye lotes y productos |
| `POST` | `/api/v1/bodegas/` | Crear bodega | Solo admin |
| `PUT` | `/api/v1/bodegas/{id}` | Actualizar bodega | Scope validation |
| `DELETE` | `/api/v1/bodegas/{id}` | Eliminar bodega | Soft delete |

**Campos Clave:**
- `capacidad`: L√≠mite m√°ximo de productos
- `tipo`: Principal, Secundaria, De tr√°nsito
- `temperatura_min/max`: Control ambiental
- `estado`: Operativa o inactiva

### üìä Productos y Stock

| M√©todo | Endpoint | Descripci√≥n | Filtrado |
|--------|----------|-------------|----------|
| `GET` | `/api/v1/productos/` | Listar productos | Por sucursal + b√∫squeda |
| `GET` | `/api/v1/productos/stats` | Estad√≠sticas de productos | Cache + sucursal |
| `GET` | `/api/v1/productos/{id}` | Detalle de producto | Validaci√≥n de scope |
| `PUT` | `/api/v1/productos/{id}` | Actualizar stock | Auditor√≠a autom√°tica |

### üèõÔ∏è Administraci√≥n

| M√©todo | Endpoint | Descripci√≥n | Permisos |
|--------|----------|-------------|----------|
| `GET` | `/api/v1/sucursales/` | Listar sucursales | Autenticado |
| `POST` | `/api/v1/sucursales/` | Crear sucursal | Admin |
| `GET` | `/api/v1/roles/` | Listar roles | Autenticado |
| `GET` | `/api/v1/auditorias/` | Consultar auditor√≠a | Admin/Auditor |
| `GET` | `/api/v1/movimientos/` | Historial movimientos | Filtrado por sucursal |

### üìà Dashboard y Reportes

| M√©todo | Endpoint | Descripci√≥n | Datos |
|--------|----------|-------------|-------|
| `GET` | `/api/v1/lotes/stats` | Stats de lotes | Activos, vencidos, pr√≥ximos |
| `GET` | `/api/v1/bodegas/stats` | Stats de bodegas | Total, operativas, capacidad |
| `GET` | `/api/v1/productos/stats` | Stats de productos | Total, bajo stock, sin stock |

**Optimizaciones:**
- ‚ö° Cach√© Redis con TTL de 60 segundos
- üîç Filtrado autom√°tico por sucursal (no-admin)
- üìä Precarga de datos populares

---

## üîê Gesti√≥n de Roles y Permisos

### Roles del Sistema

| Rol | ID | Permisos | Alcance |
|-----|-----|----------|---------|
| **ADMINISTRADOR** | 1 | ‚úÖ Acceso total | Todas las sucursales |
| **FARMAC√âUTICO** | 2 | ‚úÖ Gesti√≥n de inventario<br>‚úÖ Recepciones<br>‚úÖ Consultas | Solo su sucursal |
| **AUXILIAR** | 3 | ‚úÖ Consultas<br>‚úÖ Movimientos b√°sicos | Solo su sucursal |
| **AUDITOR** | 4 | ‚úÖ Solo lectura<br>‚úÖ Auditor√≠as | Solo su sucursal |

### M√≥dulos de Acceso

```python
# backend/app/api/deps.py

def get_user_scope(user: User) -> dict | None:
    """
    üîí FILTRADO AUTOM√ÅTICO POR SUCURSAL
    - Admin: None (ve todo)
    - Otros: {"id_sucursal": user.id_sucursal}
    """
    if user.id_rol == 1:  # ADMINISTRADOR
        return None
    return {"id_sucursal": user.id_sucursal}
```

### Matriz de Permisos

| M√≥dulo | Admin | Farmac√©utico | Auxiliar | Auditor |
|--------|-------|--------------|----------|---------|
| Dashboard | ‚úÖ Todas las sucursales | ‚úÖ Su sucursal | ‚úÖ Su sucursal | ‚úÖ Su sucursal |
| Usuarios | ‚úÖ CRUD completo | ‚ùå | ‚ùå | ‚ùå Solo lectura |
| Sucursales | ‚úÖ CRUD completo | ‚ùå Solo lectura | ‚ùå Solo lectura | ‚ùå Solo lectura |
| Bodegas | ‚úÖ CRUD completo | ‚úÖ Ver/Editar su sucursal | ‚úÖ Ver su sucursal | ‚ùå Solo lectura |
| Lotes | ‚úÖ CRUD completo | ‚úÖ CRUD su sucursal | ‚úÖ Ver su sucursal | ‚ùå Solo lectura |
| Productos | ‚úÖ CRUD completo | ‚úÖ CRUD su sucursal | ‚úÖ Ver/Editar b√°sico | ‚ùå Solo lectura |
| Recepciones | ‚úÖ Todas | ‚úÖ Su sucursal | ‚úÖ Su sucursal | ‚ùå |
| Proveedores | ‚úÖ CRUD completo | ‚úÖ Ver todos | ‚úÖ Ver todos | ‚ùå Solo lectura |
| Auditor√≠as | ‚úÖ Ver todas | ‚ùå | ‚ùå | ‚úÖ Ver su sucursal |

---

## üöÄ Tecnolog√≠as Principales

### Backend
- **FastAPI** 0.115+ - Framework web as√≠ncrono
- **SQLModel** - ORM con validaci√≥n Pydantic
- **PostgreSQL** 16+ - Base de datos principal
- **Redis** 7+ - Cache y sesiones
- **Alembic** - Migraciones de BD
- **PyJWT** - Autenticaci√≥n JWT
- **Pytest** - Testing

### Frontend
- **React** 18+ - UI Library
- **TypeScript** 5+ - Type safety
- **TanStack Router** - Routing tipado
- **TanStack Query** - Data fetching y cach√©
- **Chakra UI v3** - Component library
- **Vite** - Build tool

### DevOps
- **Docker** - Containerizaci√≥n
- **Docker Compose** - Orquestaci√≥n local
- **Traefik** - Reverse proxy
- **GitHub Actions** - CI/CD

---

## üì¶ Instalaci√≥n y Ejecuci√≥n

### Requisitos Previos

- Python 3.12+
- Node.js 20+
- PostgreSQL 16+
- Redis 7+
- Docker (opcional)

### Configuraci√≥n Backend

```bash
# Clonar repositorio
git clone https://github.com/Nick0oo/pyllren.git
cd pyllren/backend

# Crear entorno virtual
python -m venv venv
source venv/bin/activate  # En Windows: venv\Scripts\activate

# Instalar dependencias
pip install -r requirements.txt

# Configurar variables de entorno
cp .env.example .env
# Editar .env con tus credenciales

# Ejecutar migraciones
alembic upgrade head

# Iniciar servidor
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### Configuraci√≥n Frontend

```bash
cd ../frontend

# Instalar dependencias
npm install

# Configurar variables de entorno
cp .env.example .env
# Editar .env con la URL del backend

# Iniciar servidor de desarrollo
npm run dev
```

### Docker Compose (Recomendado)

```bash
# Desde la ra√≠z del proyecto
docker-compose up -d

# Acceder a:
# Frontend: http://localhost:5173
# Backend: http://localhost:8000
# Docs: http://localhost:8000/docs
```

---

## üìä Estad√≠sticas del Proyecto

- **L√≠neas de c√≥digo:** ~15,000+
- **Endpoints API:** 60+
- **Componentes React:** 50+
- **Modelos de BD:** 12
- **Tests:** 30+
- **Cobertura:** 75%+

---

## ü§ù Contribuciones

Las contribuciones son bienvenidas. Por favor:

1. Fork el proyecto
2. Crea una rama feature (`git checkout -b feature/AmazingFeature`)
3. Commit tus cambios (`git commit -m 'Add: AmazingFeature'`)
4. Push a la rama (`git push origin feature/AmazingFeature`)
5. Abre un Pull Request

---

## üìÑ Licencia

Este proyecto est√° bajo la Licencia MIT. Ver `LICENSE` para m√°s detalles.

---

## üë• Autores

- **Nick0oo** - *Desarrollo inicial* - [GitHub](https://github.com/Nick0oo)

---

## üôè Agradecimientos

- FastAPI por su excelente documentaci√≥n
- Chakra UI v3 por los componentes modernos
- TanStack por las herramientas de React
- La comunidad open source

---

<p align="center">
  Hecho con ‚ù§Ô∏è y ‚òï por el equipo de Pyllren
</p>
